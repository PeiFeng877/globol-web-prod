# 内容管理流转指南 (Content Deployment & Workflow Guidelines)
[PROTOCOL]: 变更时更新此头部，然后检查 GEMINI.md

针对当前最新重构的多语言 Payload CMS 架构，本指南解释了底层存储机制、Vercel 部署隔离策略、SEO 自动同步逻辑，以及核心的发布/翻译流转。

## 1. 核心架构认知：代码与数据的隔离脱钩
在传统的静态博客（如老旧的 Markdown 文件管理）中，文章内容是代码库的一部分。但我们当前的架构已经实现了**彻底的脱钩**。

- **代码层 (应用逻辑)**：存放在 GitHub，由 Vercel 负责拉取和运行。
- **数据层 (文字内容)**：存放在独立配置的云端 Postgres 数据库。
- **媒体层 (图片视频)**：存放在 Vercel Blob 对象存储（全球 CDN 边缘节点分发）。

### 部署与内容是否会互相覆盖？
**绝对不会。** 您需要建立以下认知：
1. **正式服新增内容 vs 本地 Vercel 部署**：
   当你在正式服（你的域名 `/admin`）里创建了大量文章和图片后，这些数据存在云端的数据库和 Blob 里。
   此时即使你在本地电脑修改了前端样式代码，并通过 `vercel --prod` 进行部署，**Vercel 只会更新前端代码**，不会触碰数据库。你的文章库**不仅不会被覆盖**，在新版本发布后依然安防在数据库中。
2. **测试服（本地）修改 vs 正式服**：
   如果你本地代码连接的是云端生产数据库（即本地 `.env.local` 填了正式库地址），你在本地 `localhost:3000/admin` 做的修改，就是在直接修改正式服数据。反之，如果连的是本地测试库，则两者相互隔离，互不干涉。

## 2. 媒体库：Vercel Blob 优势
我们的架构使用了 `@payloadcms/storage-vercel-blob` 插件拦截了 `Media` 集合的上传过程。这意味着**通过 Payload 后台上传/引用的所有图片资源，都不会驻留在项目仓库中**。
上传时直接推送到云端 Blob 仓库；下发时通过 CDN 链接交付。
- **无状态容器**：不论文章增多到十万篇/图片增加到几百 GB，项目的 Vercel 容器容量始终保持在极小状态，避免了存储爆炸和构建变慢。

## 3. SEO 与前端同步机制 (ISR)
你的主要疑虑：“内容更新后，网站其他长相列表、Sitemap 怎么同步刷新？”

### Incremental Static Regeneration (ISR) 60秒定时刷新
我们在列表页（`/date-ideas`）和文章详情页都启用了 `revalidate = 60` 机制。这是一种极其优雅的兼顾性能与实时更新的方案：
1. **对爬虫与用户的极速响应**：访客（或 Googlebot）访问页面时，拿到的是上一次已生成的纯静态 HTML。不用等待数据库查询，TTFB (首字节时间) 极快，完美兼顾 Core Web Vitals (CWV) 和 SEO 抓取性能。
2. **静默背景更新**：一旦过了 60 秒（或者你在后台发布了新文章），如果有下一个用户访问，Next.js 会立即返回旧的 HTML 给他（保证他不卡顿），同时**在后台进程悄悄触发重渲染**，拉取最新数据库内容并替换掉 CDN 里的静态文件。
3. **全局自动生效**：由于我们在同一套数据源下运作，所以当你修改文章，**不管这篇文件出现在多少个列表或者推荐侧边栏中，所有包含该数据的页面都会在这 60 秒的背景刷新周期内被统统重绘**。

### Sitemap.xml 是硬实时 (Force Dynamic)
对于 Google SEO 最核心的站点地图，我们在 `sitemap.ts` 里直接声明了 `force-dynamic`。
意味着：你在后台点击“发布”的**那一秒钟**，新的网址和多语言的 `hreflang` 解析就已经直接被写入了 `sitemap.xml`，搜索引擎永远能拿到最实时的数据索引。

## 4. 核心发布流转：一键同步编排
目前的 Payload 数据被拆分为「单语言实体对应一条记录」的模式。我们只需在新建和更新时利用 `translationGroupId` 作为联系纽带即可。以下是确切的工作流模型：

### (a) 新增一篇文章的流程
1. **源语言创作**：首先在后台 `Articles` 里点击 *Create New*，正常编写您最擅长的母语内容（例如选定 `language: zh`）。
2. **分配统一标签**：为它取一个在各个语言下**恒定不变**的 `translationGroupId`（例如：`cute-date-ideas-guide`），点击发布。
3. **一键翻译脚本（系统侧自动工作流预期）**：
   未来开发好相关机制后，系统底层会：
    - 读取 `language=zh` 以及 `translationGroupId=cute-date-ideas-guide` 的记录。
    - 将内容送入 LLM 进行多语言翻译。
    - 调用 `payload.create()` **分批生成其余语言版本的实体**。这些生成的记录各自带有正确的 `language` 标签，并**全部强制绑定同样的 `translationGroupId`**。

### (b) 更新某篇文章内容的同步流程
当过了一段时间，您需要修改上述的源语言文章内容时：
1. **更新源文件**：进入 Payload CMS `Articles` 列表，使用 Filter 过滤出原文并进入重新编辑保存。
2. **触发同步更新（系统侧自动工作流预期）**：
   - 系统直接根据这篇文章身上的 `translationGroupId=cute-date-ideas-guide` 去数据库并发 `find()` 该 ID 下的所有关联翻译子集。
   - 比较差异后全量重翻，并顺着查到的实体 ID 进行覆写。

## 5. 潜在站点管理与 SEO 风险预警
为了确保项目健康运行，您必须留意以下边界情况：

1. **废弃旧路由 (404 困境)**
   如果你手残在后台删除了某篇已经被 Google 收录的文章（如 `slug: cute-date-ideas`），前端将自动返回 404 页面。如果这篇文章曾经有很多外部流量，**建议不要直接删除，而是将其改为空壳重定向**。
2. **多语言 URL (Slug) 同步性**
   在新的架构下，建议不同语言的**同一篇文章保持使用同样的英文 `slug`**。一来是为了匹配 `translationGroupId` 的管理直觉，二来避免了诸如拼音、小语种字符导致的 URL 乱码，也便于排查。
3. **不要混淆测试库与生产库**
   既然数据库和代码解耦了，那么你在 Vercel 配置的环境变量应该是线上长期数据库，而在本地开发如果涉及到破坏性测试，必须使用新的分支或者连另一套 Local 测试数据库，否则很容易污染生产环境的结构。
